<?php

/**
 * site enter point 
 * router throught request URL 
 * 	e.g.
 * (www.xxx.com/colg110002/)example => will router to /code/example.php
 * (www.xxx.com/colg110002/)hello/test/test => will router to /code/hello/test/test.php
 * (www.xxx.com/colg110002/)hello/control => will router to /code/hello/control.php (
 * 										*use standard control class format :see controll.class.php's control class in system/class
 */

	/**
	 * load system file
	 */
	require_once('config/config.php');
//



if(preg_match('/(81|\.com\/pa\/|\.com\/preview\/)/i',DOMAIN_ROOT)){

	switch (true){
		case preg_match('/81/i',DOMAIN_ROOT):
				$id="local";
				$pass="81";
			break;
		case preg_match('/\.com\/pa\//i',DOMAIN_ROOT):
				$id="vip";
				$pass="f67s02";
			break;
		case preg_match('/\.com\/preview\//i',DOMAIN_ROOT):
				$id="viewnow";
				$pass="9a82ke";
			break;
	}
	
	if ($_SERVER['PHP_AUTH_USER'] != $id || $_SERVER['PHP_AUTH_PW'] != $pass ) {
	    header('WWW-Authenticate: Basic realm="Login"');
	    header('HTTP/1.0 401 Unauthorized');
    	die('User Canceled');
	}
		
	
}


if(!$_POST && !$_GET && $_SERVER['QUERY_STRING']){
	parse_str($_SERVER['QUERY_STRING'],$tmp);
	$_REQUEST = xpAS::merge($tmp, $_REQUEST);
}

	
	/**
	 * count IE shit problem
	 */
//	header('P3P: CP="IDC DSP COR ADM DEVi TAIi PSA PSD IVAi IVDi CONi HIS OUR IND CNT"');
//	header('P3P: CP="NOI ADM DEV COM NAV OUR STP"');
	/**
	 * start session
	 */
	xpSession::start();

	/**
	 * get routing information
	 */
	$path_info = rewrite::routing();

//_debug($path_info);
	/**
	 * check valid route
	 */
	if(!$path_info['handler']){
		$u = strtolower(str_replace(DIR_OFFSET .DS ,'', $_SERVER['REDIRECT_URL']));
		$path_info['handler']=FILE_ROOT.DS.'code'.DS.'site.php';
	//	$path_info['handler']=FILE_ROOT.DS.'system'.DS.'404'.DS.'404.php';
	}
	

	/**
	 * get template related info
	 */
	$skin = xpSession::get('skin,name');
	global_data::set('skin,name', $skin ? $skin : 'default' ); 
	global_data::set('path_info', $path_info); 
	global_data::set('cfg', $cfg); 
	
	
	/**
	 * load routed file
	 */

	include_once($path_info['handler']);

	/**
	 * start control class if hash one
	 */
	if(class_exists('control')){
		$p = new control();
		$p->process();
	}
	
